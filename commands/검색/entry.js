const fetch = require("node-fetch"), { MessageEmbed } = require("discord.js");
module.exports = {
    name: "엔트리",
    aliases: [],
    category: "검색",
    run: async (client, message, args, ops) => {if (!args.join(" ")) return message.channel.send("엔트리 유저 닉네임을 ㅇㅣㅂ력해라 우어어..."); let res; try {res = await fetch(`https://playentry.org/api/getUserByUsername/${encodeURI(args.join(" "))}`).then(e => e.json()); if (!res) return message.channel.send("우어.. 유저를 못 차..찾겠다..");} catch (e) {return message.channel.send("우어.. 에러..:\n", e.message || e)} const { username, description, _id, role, avatarImage, blogImage } = res; const project = await fetch(`https://playentry.org/api/project/find?option=list&tab=my_project&type=project&user=${_id}`).then(e => e.json()); const discuss = await fetch(`https://playentry.org/api/discuss/find?username=${encodeURI(username)}`).then(e => e.json()); const embed = new MessageEmbed().setColor(0x00ff00).setTitle(username).setURL(`https://playentry.org/${encodeURI(args.join(" "))}`).addField("상태메세지", description ? description : "없음").addField("계정", roles[role]).addField("ID", _id).addField("작품 수", project.count, true); embed.setThumbnail(!avatarImage ? "https://playentry.org/img/assets/avatar_img.png" : `https://playentry.org/uploads/profile/${_id.substr(0, 2)}/${_id.substr(2, 2)}/avatar_${_id}.png`); if (blogImage) embed.setImage(`https://playentry.org/uploads/profile/${_id.substr(0, 2)}/${_id.substr(2, 2)}/blog_${_id}.png`); let likeCount = 0, visitCount = 0, commentCount = 0, childCount = 0; project.data.forEach(i => {likeCount += i.likeCnt; visitCount += i.visit; commentCount += i.comment; childCount += i.childCnt}); embed.addField("좋아요 수", parseInt(likeCount).toLocaleString(), true).addField("조회수", parseInt(visitCount).toLocaleString(), true).addField("작품 댓글 수", parseInt(commentCount).toLocaleString(), true).addField("작품 사본 수", isNaN(parseInt(childCount).toLocaleString()) ? "알 수 없음" : parseInt(childCount).toLocaleString(), true).addField("글 수", parseInt(discuss.count).toLocaleString(), true); message.channel.send(embed)}
}
const roles = {member: "학생 계정", student: "학생 계정", teacher: "선생님 계정", admin: "관리자 계정(운영자님)"}